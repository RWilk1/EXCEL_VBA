
' txt_godz_start
' SpinButton1
' txt_minuta_start
' SpinButton2
' CommandButton1
' Start_Koniec - text box ukryty


' Zmienna wskażnikowa informująca o wystąpieniu błędu
Public Czy_Blad As Integer
''''''''''''''''''''''''''''''''''

Private Sub CommandButton1_Click()

Czy_Blad = 0

' Walidacja danych po 24:00 nie można wpisywać żadnych minut
If txt_godz_start.Value = 24 Then
    txt_minuta_start.Value = "0"
End If

' Czy błąd
Call Kontr_Godz(Me.Start_Koniec.Value)

' Jeśli wystąpił błąd to koniec procedurki
If Czy_Blad = 1 Then Exit Sub


' Poprawa wyświetlania wybranych wartości
If Len(txt_godz_start.Value) = 1 Then
    txt_godz_start.Value = "0" & txt_godz_start.Value
End If

If Len(txt_minuta_start.Value) = 1 Then
    txt_minuta_start.Value = txt_minuta_start.Value & "0"
End If

''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' Printowanie wybranych wartości do pól tekstowych
If Me.Start_Koniec.Value = 0 Then
    App_Awarie.txt_Start_Godz.Value = _
        txt_godz_start.Value & ":" & txt_minuta_start
    Unload Me
Else
    App_Awarie.txt_Koniec_Godz.Value = _
        txt_godz_start.Value & ":" & txt_minuta_start
    Unload Me
End If

End Sub

Private Sub UserForm_Initialize()

txt_godz_start.Text = Mid(Now(), 12, 2)
txt_minuta_start.Text = Mid(Now(), 15, 2)
    
End Sub

Private Sub SpinButton1_Change()
    
    txt_godz_start.Text = SpinButton1.Value
    
End Sub

Private Sub SpinButton2_Change()
    
    txt_minuta_start.Text = SpinButton2.Value
    
End Sub

Private Function Kontr_Godz(Start_Koniec As Integer)

Dim Data_Godz_Start As Variant
Dim Data_Godz_Koniec As Variant

'Data_Godz_Start = App_Awarie.txt_Start_Date.Value & " " & App_Awarie.txt_Start_Godz.Value
'Data_Godz_Koniec = App_Awarie.txt_End_Date.Value & " " & App_Awarie.txt_Koniec_Godz.Value

' W przypadku ustalania godziny początkowej
If Start_Koniec = 0 Then
    Data_Godz_Start = App_Awarie.txt_Start_Date.Value & " " & Me.txt_godz_start.Value & ":" & Me.txt_minuta_start.Value
    Data_Godz_Koniec = App_Awarie.txt_End_Date.Value & " " & App_Awarie.txt_Koniec_Godz.Value
End If

' W przypadku ustalania godziny końcowej
If Start_Koniec = 1 Then
    Data_Godz_Start = App_Awarie.txt_Start_Date.Value & " " & App_Awarie.txt_Start_Godz.Value
    Data_Godz_Koniec = App_Awarie.txt_End_Date.Value & " " & Me.txt_godz_start.Value & ":" & Me.txt_minuta_start.Value
End If

Debug.Print Data_Godz_Start
Debug.Print Data_Godz_Koniec
Debug.Print Me.Start_Koniec.Value
Debug.Print Czy_Blad

' Godzina Startowa
If Me.Start_Koniec.Value = 0 Then
   ' Kontrola wpisywanych godz.
    If CDate(Data_Godz_Start) > CDate(Data_Godz_Koniec) Then
        MsgBox "Wpisana data i godzina początkowa jest póżniejsza od daty i godziny końcowej!!!" & vbCrLf _
            & "Wybierz poprawną datę i godzinę", vbCritical
        Czy_Blad = 1
        Exit Function
    End If
    
End If

If Me.Start_Koniec.Value = 1 Then
   ' Kontrola wpisywanych godz.
    If CDate(Data_Godz_Koniec) < CDate(Data_Godz_Start) Then
        MsgBox "Wpisana data i godzina końcowa jest wcześniejsza od daty i godziny początkowej!!!" & vbCrLf _
            & "Wybierz poprawną datę i godzinę", vbCritical
        Czy_Blad = 1
        Exit Function
    End If
    
End If

End Function



